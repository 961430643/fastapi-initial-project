<!--张振锟-->
以下是三个文件（auth.py、main.py 和 `__init__.py`）在开发中所遇到的问题及通过询问AI获得的解决方案：


### **1. 认证问题 (auth.py)**
| 问题描述                     | 解决方案                                                                 |
|------------------------------|--------------------------------------------------------------------------|
| **令牌验证失败**：JWT 过期、签名错误或用户不存在 | 检查令牌生成/验证逻辑，确保密钥一致，添加异常捕获和清晰的错误提示          |
| **依赖注入失效**：`get_current_user` 无法正确获取用户 | 确认路由中正确使用 `Depends()`，检查用户数据库查询逻辑                    |
| **OAuth2 流程错误**：无法通过 `/user/login` 获取 token | 验证密码哈希逻辑，检查请求格式是否符合 `OAuth2PasswordRequestForm` 规范   |

---

### **2. 路由与配置问题 (main.py)**
| 问题描述                     | 解决方案                                                                 |
|------------------------------|--------------------------------------------------------------------------|
| **CORS 跨域错误**：前端请求被浏览器拦截 | 检查 `CORSMiddleware` 配置，确保 `allow_origins` 包含正确的前端域名或 `*` |
| **路由未加载**：新增的 API 端点无法访问 | 确认路由已通过 `indexRoute.load_routes(app)` 正确注册                     |
| **生产部署失败**：Uvicorn 服务无法启动 | 检查端口占用情况，使用 `--workers` 配置多进程，添加 `--proxy-headers` 选项 |

---

### **3. 包结构问题 (`__init__.py`)**
| 问题描述                     | 解决方案                                                                 |
|------------------------------|--------------------------------------------------------------------------|
| **模块导入错误**：`from app.auth import ...` 失败 | 确保所有包目录包含 `__init__.py`（Python 3.3+ 可省略但建议保留）          |
| **循环依赖**：模块间相互引用导致启动崩溃 | 重构代码结构，将公共依赖提取到独立模块，使用延迟导入（Lazy Import）       |

---

### **4. 其他常见问题**
| 问题描述                     | 解决方案                                                                 |
|------------------------------|--------------------------------------------------------------------------|
| **性能问题**：API 响应缓慢   | 启用 GZip 压缩中间件，优化数据库查询，使用缓存机制（如 Redis）           |
| **配置泄露**：敏感信息（如密钥）硬编码在代码中 | 将配置移至环境变量或 `.env` 文件，使用 `python-dotenv` 加载              |
| **文档缺失**：API 接口无文档 | 为路由添加 Swagger 注释，利用 FastAPI 自动生成 `/docs` 接口文档           |

---

### **问题排查流程图**
```
问题发生 → 检查日志/错误信息 
    → 定位问题模块（认证/路由/配置） 
    → 验证依赖项版本（FastAPI/Pydantic/Uvicorn） 
    → 单元测试复现问题 
    → 修复并验证
```
<!--张振锟-->

<!-- by 2205308010338蒙思勇 -->
1、错误信息：重复定义了数据库表，或者模型类未正确继承 Base。
ai给出解决方法：确保所有模型类都继承自 Base（通常从 app.database 中导入），检查是否有重复的表名。

2、错误信息：数据库未创建或未正确连接。
ai给出解决方法：确保数据库已创建。检查 config.py 中的数据库配置是否正确。

3、错误信息：数据库字段类型与模型定义不匹配。
ai给出解决方法：检查模型字段类型是否与数据库表字段类型一致。如果修改了模型字段类型，确保同步更新数据库表结构。

4、错误信息：环境变量缺失。
ai给出解决方法：检查 .env 文件或环境变量配置是否正确。

5、错误信息：未正确安装依赖。
ai给出解决方法：pip install fastapi

<!-- by 2205308010338蒙思勇 -->

